{% load static %}
{% block extra_css %}
    <link rel='stylesheet' href="{% static 'store/css/review.css' %}" />
{% endblock %}
{% block extra_head_js %}
    <script src="{% static 'store/js/review.js' %}"></script>
{% endblock %}

{% block review_modal %}

<div class="modal fade" id="review-modal" tabindex="-1" role="dialog" aria-labelledby="review modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Add a review</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class=" text-center ">

          <h2>What is your rating?</h2>
            <div class="rating pt-">
              
                <input type="radio" name="rating" value="5" id="5" required><label for="5">☆</label>
                <input type="radio" name="rating" value="4" id="4" required><label for="4">☆</label>
                <input type="radio" name="rating" value="3" id="3" required><label for="3">☆</label>
                <input type="radio" name="rating" value="2" id="2" required><label for="2">☆</label>
                <input type="radio" name="rating" value="1" id="one" required><label for="1">☆</label>
            </div>
            <div class='d-none mb-2' id='val-stars'><small class='text-danger' >Please leave at least 1 star!</small></div>
            <div class="review-content"> <textarea class="form-control" id="review-content" placeholder="what is your review?" rows="20"></textarea> </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" id="save-review-btn" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
<script>

    $(document).on('click', '#save-review-btn', function(e){
        if(!$("input[type='radio'][name='rating']:checked").val()){
          $('#val-stars').removeClass('d-none')
          document.querySelector("#one").checked = true
        } else {
            $('#review-modal').modal('hide');
            $.ajax({
            type: 'POST',
            url: '{% url "store:add_review" %}',
            data: {
                product_id: $("#add-btn").val(),
                rating: $("input[type='radio'][name='rating']:checked").val(),
                review: $('#review-content').val(),
                csrfmiddlewaretoken: "{{csrf_token}}",
                action: 'post'
            },
            success: function(json){
                let user = '{{request.user.username}}'
                let review = json.review
                let rating = json.rating
                addReview(user, review, rating)
                
            },
            error: function(xhr, errmsg, err){}
        })
        }
        
    })
    
</script>
{% endblock %}